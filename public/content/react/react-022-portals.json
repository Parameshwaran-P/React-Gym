{
  "id": "react-022-portals",
  "title": "React Portals",
  "description": "Render components outside the normal DOM hierarchy",
  "duration": 8,
  "difficulty": "intermediate",
  "tags": ["react", "portals", "dom"],
  "prerequisites": ["react-021-refs"],
  "unlocks": ["react-023-error-boundaries"],
  "xp": 120,

  "steps": {
    "intro": {
      "type": "game-intro",
      "title": "Escape the DOM Tree",
      "story": "Some UI elements break layout rules. Let's learn how to teleport them.",
      "preview": "Modals, tooltips, and overlays without CSS hacks."
    },

    "refresher": {
      "type": "markdown",
      "title": "The DOM Problem",
      "content": "Normally, React renders components **inside their parent DOM node**.\n\nThis causes issues for:\n- Modals\n- Tooltips\n- Dropdowns\n- Popups\n\nThey get **clipped**, **hidden**, or **misaligned** due to parent styles."
    },

    "concept": {
      "type": "markdown",
      "title": "What is a Portal?",
      "content": "A **Portal** lets React render a component **outside its parent DOM hierarchy**.\n\nThe component still behaves like a normal React child:\n- Props work\n- State works\n- Events bubble correctly"
    },

    "syntax": {
      "type": "markdown",
      "title": "Portal Syntax",
      "content": "```\nReactDOM.createPortal(element, container)\n```\n\n- `element` → what to render\n- `container` → where in the DOM"
    },

    "positive": {
      "type": "interactive-code",
      "title": "Simple Portal Example",
      "description": "Render modal into a separate DOM node.",
      "code": "import ReactDOM from 'react-dom';\n\nfunction Modal({ children }) {\n  return ReactDOM.createPortal(\n    <div className=\"modal\">{children}</div>,\n    document.getElementById('modal-root')\n  );\n}\n\nexport default Modal;",
      "showPreview": true,
      "explanation": "The modal renders outside the parent DOM tree."
    },

    "concept2": {
      "type": "markdown",
      "title": "Why Not Just CSS?",
      "content": "CSS `position: fixed` is **not enough**.\n\nProblems without portals:\n- `overflow: hidden`\n- `z-index` conflicts\n- Nested stacking contexts\n\nPortals solve this cleanly."
    },

    "negative": {
      "type": "debug-quiz",
      "title": "Why Modal Is Hidden?",
      "description": "Modal renders but is not visible.",
      "code": "function App() {\n  return (\n    <div style={{ overflow: 'hidden' }}>\n      <Modal />\n    </div>\n  );\n}",
      "question": "Best solution?",
      "options": [
        {
          "id": "a",
          "text": "Increase z-index",
          "isCorrect": false,
          "explanation": "Z-index won't escape parent overflow."
        },
        {
          "id": "b",
          "text": "Use React Portal",
          "isCorrect": true,
          "explanation": "Portal renders outside overflow container."
        }
      ],
      "lesson": "Portals bypass DOM layout limitations."
    },

    "positive2": {
      "type": "interactive-code",
      "title": "Portal with Overlay",
      "description": "Create a full-screen overlay modal.",
      "code": "import ReactDOM from 'react-dom';\n\nfunction Overlay({ onClose }) {\n  return ReactDOM.createPortal(\n    <div className=\"overlay\" onClick={onClose}>\n      <div className=\"content\">Hello Portal</div>\n    </div>,\n    document.body\n  );\n}\n\nexport default Overlay;",
      "showPreview": true,
      "explanation": "Overlay renders directly into document body."
    },

    "task": {
      "type": "coding-task",
      "title": "Create Modal Portal",
      "description": "Render modal content using portal.",
      "requirements": [
        "Use createPortal",
        "Render outside parent",
        "Close on click"
      ],
      "starterCode": "function Modal() {\n  return <div>Modal</div>;\n}\n\nexport default Modal;",
      "solution": "import ReactDOM from 'react-dom';\n\nfunction Modal({ onClose }) {\n  return ReactDOM.createPortal(\n    <div onClick={onClose}>Modal</div>,\n    document.body\n  );\n}\n\nexport default Modal;",
      "hints": [
        "Use ReactDOM.createPortal",
        "Target document.body"
      ]
    },

    "challenge": {
      "type": "coding-challenge",
      "title": "Advanced Modal",
      "description": "Prevent background click from closing modal.",
      "requirements": [
        "Overlay click closes modal",
        "Content click does not"
      ],
      "solution": "import ReactDOM from 'react-dom';\n\nfunction Modal({ onClose }) {\n  return ReactDOM.createPortal(\n    <div className=\"overlay\" onClick={onClose}>\n      <div className=\"content\" onClick={e => e.stopPropagation()}>\n        Modal Content\n      </div>\n    </div>,\n    document.body\n  );\n}\n\nexport default Modal;"
    },

    "memory": {
      "type": "memory-game",
      "title": "Portal Memory",
      "pairs": [
        { "concept": "Portal", "code": "Render outside DOM tree" },
        { "concept": "createPortal", "code": "Teleport UI" },
        { "concept": "Modal", "code": "Common use case" },
        { "concept": "Events", "code": "Bubble normally" }
      ]
    },

    "tower": {
      "type": "tower-defense",
      "concepts": [
        {
          "question": "Portals are used to?",
          "options": ["Share props", "Escape DOM tree", "Optimize state", "Handle API"],
          "correct": 1
        },
        {
          "question": "Where can portals render?",
          "options": ["Only root", "Any DOM node", "Only parent", "Only fragment"],
          "correct": 1
        }
      ],
      "waves": 3
    }
  }
}
