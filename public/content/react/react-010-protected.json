{
  "id": "react-010-protected",
  "title": "Protected Routes",
  "description": "Restrict access to certain routes/pages in React based on user roles or authentication",
  "duration": 10,
  "difficulty": "intermediate",
  "tags": ["router", "protected-routes", "authentication"],
  "prerequisites": ["react-009-router"],
  "unlocks": ["react-011-performance"],
  "xp": 80,
    "preview": {
        "videoUrl": "/public/input.mp4", 
        "platform": "direct",
        "thumbnail": "/thumbnails/custom-hooks.jpg",
        "duration": "10:15"
      },
  "steps": {
    "refresher": {
      "type": "markdown",
      "title": "üè• Real-Life Story: Doctor vs Nurse Access",
      "content": "# üè• Access Control in Hospital App\n\nIn our hospital app, different roles have different permissions:\n\n- **Doctors**: Can view all patients and update statuses\n- **Nurses**: Can view patients but cannot discharge\n- **Guests**: Cannot access patient details\n\n‚ùå Problem: Without protected routes, anyone can access sensitive pages by typing the URL.\n\n---\n\n## üß† Why This Happens\n\n- React is client-side only\n- Pages/components render if included in Routes\n- We need a **guard layer** to prevent unauthorized access\n\n---\n\n## ‚úÖ React Solution: Protected Routes\n\n- Create a **wrapper component** (`ProtectedRoute`) that checks permissions\n- Only render the child component if allowed\n- Otherwise, redirect to login or error page\n\nThink of it as a **hospital security checkpoint**: only authorized staff can enter certain rooms."
    },
    "positive": {
      "type": "interactive-code",
      "title": "‚úÖ Positive Case: Protect Patient Dashboard",
      "description": "Create a ProtectedRoute component to restrict access based on role.",
      "code": "import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\n\nfunction ProtectedRoute({ children, role, allowedRoles }) {\n  if (!allowedRoles.includes(role)) {\n    return <Navigate to='/' replace />; // Redirect to Home if not allowed\n  }\n  return children;\n}\n\nfunction Home() {\n  return <h2>Hospital Home</h2>;\n}\n\nfunction PatientDashboard() {\n  return <h2>Patient Dashboard (Sensitive Data)</h2>;\n}\n\nfunction HospitalApp() {\n  const userRole = 'nurse'; // Example role: doctor / nurse / guest\n\n  return (\n    <Router>\n      <Routes>\n        <Route path='/' element={<Home />} />\n        <Route\n          path='/dashboard'\n          element={\n            <ProtectedRoute role={userRole} allowedRoles={['doctor']}>\n              <PatientDashboard />\n            </ProtectedRoute>\n          }\n        />\n      </Routes>\n    </Router>\n  );\n}\n\nexport default HospitalApp;",
      "showPreview": true,
      "explanation": "**How it works:**\n\n1. `ProtectedRoute` checks if `role` is in `allowedRoles`\n2. If allowed, renders the children component\n3. Otherwise, redirects to home\n4. Components stay clean and permission logic is centralized\n\n‚úÖ **Key Rule:** Always centralize access control to avoid mistakes."
    },
    "negative": {
      "type": "debug-quiz",
      "title": "üêõ Common Mistake: Conditional Rendering in Each Page",
      "description": "Why is adding `if (role !== 'doctor') return <Home />` inside every sensitive page a bad idea?",
      "code": "function PatientDashboard({ role }) {\n  if (role !== 'doctor') return <Home />;\n  return <h2>Patient Dashboard</h2>;\n}",
      "question": "What's wrong with this approach?",
      "options": [
        {
          "id": "a",
          "text": "It works fine, nothing wrong",
          "isCorrect": false,
          "explanation": "It works but spreads logic across multiple pages."
        },
        {
          "id": "b",
          "text": "Logic is repeated in every component, hard to maintain",
          "isCorrect": true,
          "explanation": "‚úÖ Correct! ProtectedRoute centralizes permission checks."
        },
        {
          "id": "c",
          "text": "React Router cannot handle conditional rendering",
          "isCorrect": false,
          "explanation": "React Router supports conditional rendering but centralization is best."
        },
        {
          "id": "d",
          "text": "Redirects will break SPA behavior",
          "isCorrect": false,
          "explanation": "Redirect works fine with Navigate component."
        }
      ],
      "correctCode": "Use a ProtectedRoute wrapper to handle permissions instead of sprinkling if-checks in every page."
    },
    "task": {
      "type": "coding-task",
      "title": "üõ†Ô∏è Your Turn: Protect Patient Dashboard",
      "description": "Implement a ProtectedRoute component and use it to restrict access to PatientDashboard for doctors only.",
      "requirements": [
        "Create ProtectedRoute component",
        "Accept props: role and allowedRoles",
        "Use Navigate for redirect",
        "Wrap PatientDashboard route with ProtectedRoute"
      ],
      "starterCode": "import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';\n\nfunction Home() { return <div>TODO</div>; }\nfunction PatientDashboard() { return <div>TODO</div>; }\nfunction ProtectedRoute({ children, role, allowedRoles }) { return null; }\n\nfunction HospitalApp() {\n  const userRole = 'nurse';\n  return <Router>{/* TODO */}</Router>;\n}\n\nexport default HospitalApp;",
      "solution": "/* Same as Positive Case Code Above */",
      "hints": [
        "Use Navigate for redirect",
        "Check if role exists in allowedRoles",
        "ProtectedRoute should wrap the route element"
      ],
      "tests": [
        "Doctor can access PatientDashboard",
        "Nurse or guest is redirected to Home",
        "Unauthorized access blocked even if URL typed manually"
      ]
    },
    "challenge": {
      "type": "coding-challenge",
      "title": "üèÜ Challenge: Multi-Role Hospital App",
      "description": "Create a hospital app with multiple protected routes: Doctors, Nurses, and Admins. Each role sees different dashboards.",
      "requirements": [
        "ProtectedRoute handles multiple roles",
        "Doctors see full patient data",
        "Nurses see limited data",
        "Admins can manage users",
        "Unauthorized roles are redirected to Home or Login"
      ],
      "starterCode": "/* Use Router + ProtectedRoute + role variable */",
      "solution": "/* Wrap routes in ProtectedRoute and define allowedRoles per route */",
      "hints": [
        "Use array of allowedRoles for each route",
        "Centralize permission logic in ProtectedRoute",
        "Use Navigate for redirects"
      ],
      "tests": [
        "Each role sees only allowed routes",
        "Unauthorized access redirects correctly",
        "Navigation links reflect role permissions"
      ]
    }
  }
}
