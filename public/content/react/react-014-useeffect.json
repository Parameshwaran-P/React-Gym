{
  "id": "react-002-useeffect",
  "title": "useEffect Hook",
  "description": "Handle side effects and lifecycle behavior in React components",
  "duration": 9,
  "difficulty": "beginner",
  "tags": ["hooks", "side-effects", "lifecycle"],
  "prerequisites": ["react-001-usestate"],
  "unlocks": ["react-003-props"],
  "xp": 70,

  "preview": {
    "videoUrl": "/public/useeffect-intro.mp4",
    "platform": "direct",
    "thumbnail": "/thumbnails/useeffect.jpg",
    "duration": "11:40"
  },

  "steps": {
    "intro": {
      "type": "game-intro",
      "title": "‚è≥ Enter the Time Chamber",
      "story": "Welcome to the Time Chamber! Events happen AFTER the screen updates. Notifications, API calls, timers ‚Äî if you don‚Äôt control time, chaos begins.",
      "preview": "You‚Äôll master effects, dependencies, cleanups, and lifecycle powers."
    },

    "refresher": {
      "type": "markdown",
      "title": "üß† What is useEffect?",
      "content": "# ‚è∞ Real-Life Story: Gym Notification System\n\nYour **React Gym** opens at 6 AM.\n\nWhen the gym opens:\n- Send welcome notification\n- Start background music\n- Fetch today‚Äôs trainer schedule\n\nThese things **should NOT run during rendering**.\n\nThey must run **AFTER the screen updates**.\n\n---\n\n## üß† Side Effects\nSide effects are:\n- API calls\n- Timers\n- Subscriptions\n- DOM updates\n\n---\n\n## ‚úÖ useEffect to the Rescue\n\n`useEffect` lets React say:\n\n> \"Render first. Then run this code.\"\n\n---\n\n## üîß Syntax\n\n```js\nuseEffect(() => {\n  // side effect\n}, [dependencies]);\n```\n\nüëâ Dependencies control **WHEN** the effect runs."
    },

    "positive": {
      "type": "interactive-code",
      "title": "‚úÖ Effect on Mount",
      "description": "This effect runs once when the component loads.",
      "code": "import { useEffect } from 'react';\n\nfunction GymOpen() {\n  useEffect(() => {\n    console.log('Gym is now OPEN!');\n  }, []);\n\n  return <h2 className=\"text-xl\">React Gym</h2>;\n}\n\nexport default GymOpen;",
      "showPreview": true,
      "explanation": "Empty dependency array = run once (component mount)."
    },

    "negative": {
      "type": "debug-quiz",
      "title": "üêõ Infinite Loop Bug",
      "description": "Why does this crash the app?",
      "code": "import { useState, useEffect } from 'react';\n\nfunction BuggyCounter() {\n  const [count, setCount] = useState(0);\n\n  useEffect(() => {\n    setCount(count + 1);\n  });\n\n  return <p>{count}</p>;\n}",
      "question": "What is the bug?",
      "options": [
        {
          "id": "a",
          "text": "Missing return statement",
          "isCorrect": false
        },
        {
          "id": "b",
          "text": "Effect runs on every render causing infinite updates",
          "isCorrect": true,
          "explanation": "‚úÖ Correct! Missing dependency array causes endless re-renders."
        },
        {
          "id": "c",
          "text": "useState is wrong",
          "isCorrect": false
        }
      ],
      "correctCode": "useEffect(() => {\n  setCount(count + 1);\n}, []);",
      "lesson": "‚ùå Effects without dependencies run after EVERY render.\n\n‚úÖ Always control effects using dependency arrays."
    },

    "task": {
      "type": "coding-task",
      "title": "üõ†Ô∏è Task: Page Title Setter",
      "description": "Set the browser tab title when the component loads.",
      "requirements": [
        "Use useEffect",
        "Set document.title",
        "Run only once"
      ],
      "starterCode": "import { useEffect } from 'react';\n\nfunction PageTitle() {\n  // TODO\n  return <h2>Dashboard</h2>;\n}\n\nexport default PageTitle;",
      "solution": "useEffect(() => {\n  document.title = 'React Gym Dashboard';\n}, []);",
      "hints": [
        "useEffect runs after render",
        "Empty dependency array = once"
      ]
    },

    "challenge": {
      "type": "coding-challenge",
      "title": "üèÜ Challenge: Auto Timer",
      "description": "Start a timer when component mounts and stop it on unmount.",
      "requirements": [
        "Use setInterval",
        "Clean up interval",
        "Display seconds"
      ],
      "solution": "useEffect(() => {\n  const id = setInterval(() => setTime(t => t + 1), 1000);\n  return () => clearInterval(id);\n}, []);"
    },

    "battle1": {
      "type": "code-battle",
      "title": "Battle: Dependency Dragon",
      "enemy": {
        "name": "Dependency Dragon",
        "avatar": "üêâ",
        "health": 120
      },
      "task": "Fix the dependency array to stop the dragon!"
    },

    "bughunt": {
      "type": "bug-hunt-shooter",
      "code": "useEffect(() => {\n  fetchData();\n}, [fetchData]);",
      "bugs": [
        {
          "id": "bug1",
          "type": "logic",
          "description": "Function recreated every render",
          "fix": "Wrap fetchData in useCallback"
        }
      ],
      "timeLimit": 45
    },

    "memory": {
      "type": "memory-game",
      "pairs": [
        { "concept": "[]", "code": "Run once on mount" },
        { "concept": "[count]", "code": "Run when count changes" },
        { "concept": "return cleanup", "code": "Run on unmount" },
        { "concept": "useEffect", "code": "Handle side effects" }
      ]
    },

    "tower": {
      "type": "tower-defense",
      "concepts": [
        {
          "question": "When does useEffect run?",
          "options": [
            "Before render",
            "During render",
            "After render",
            "Instead of render"
          ],
          "correct": 2
        }
      ],
      "waves": 2
    }
  }
}
