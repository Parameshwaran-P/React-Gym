{
  "id": "react-015-data-fetching",
  "title": "Data Fetching with useEffect",
  "description": "Learn how to get data from an API and show it in React",
  "duration": 11,
  "difficulty": "beginner",
  "tags": ["react", "api", "fetch", "useeffect"],
  "prerequisites": ["react-014-useeffect"],
  "unlocks": ["react-016-custom-hooks"],
  "xp": 110,

  "steps": {
    "intro": {
      "type": "game-intro",
      "title": "Bringing Data from Outside",
      "story": "Your app needs information from the outside world.",
      "preview": "Learn how React talks to servers."
    },

    "refresher": {
      "type": "markdown",
      "title": "Real-Life Example",
      "content": "# Ordering Food\n\nYou order food\n\nRestaurant prepares it\n\nFood arrives after some time\n\n---\n\n## Same in React\n\nRequest ➜ Wait ➜ Data arrives"
    },

    "concept": {
      "type": "markdown",
      "title": "What is Data Fetching?",
      "content": "Data fetching means **getting data from a server**.\n\nExamples:\n- User list\n- Products\n- Posts\n\nReact uses:\n- fetch()\n- useEffect()\n- state"
    },

    "syntax": {
      "type": "markdown",
      "title": "Basic Pattern",
      "content": "```\nuseEffect(() => {\n  fetch(url)\n    .then(res => res.json())\n    .then(data => setData(data));\n}, []);\n```"
    },

    "positive": {
      "type": "interactive-code",
      "title": "Fetch Posts",
      "description": "Get data after component loads.",
      "code": "import { useEffect, useState } from 'react';\n\nfunction Posts() {\n  const [posts, setPosts] = useState([]);\n\n  useEffect(() => {\n    fetch('https://jsonplaceholder.typicode.com/posts?_limit=3')\n      .then(res => res.json())\n      .then(data => setPosts(data));\n  }, []);\n\n  return (\n    <ul>\n      {posts.map(post => (\n        <li key={post.id}>{post.title}</li>\n      ))}\n    </ul>\n  );\n}\n\nexport default Posts;",
      "showPreview": true,
      "explanation": "Data is fetched once after first render."
    },

    "concept2": {
      "type": "markdown",
      "title": "Why useEffect?",
      "content": "Fetching data during render causes problems.\n\nuseEffect ensures:\n- Fetch runs after UI loads\n- No infinite loops\n- Clean lifecycle handling"
    },

    "negative": {
      "type": "debug-quiz",
      "title": "Infinite Fetch Bug",
      "description": "Why is API called again and again?",
      "code": "useEffect(() => {\n  fetch(url).then(r => r.json()).then(setData);\n});",
      "question": "What is missing?",
      "options": [
        {
          "id": "a",
          "text": "Dependency array",
          "isCorrect": true,
          "explanation": "Without it, effect runs on every render."
        },
        {
          "id": "b",
          "text": "useState",
          "isCorrect": false,
          "explanation": "State is already present."
        }
      ],
      "lesson": "Always control when effects run."
    },

    "positive2": {
      "type": "interactive-code",
      "title": "Fetch User",
      "description": "Display user name.",
      "code": "import { useEffect, useState } from 'react';\n\nfunction User() {\n  const [user, setUser] = useState(null);\n\n  useEffect(() => {\n    fetch('https://jsonplaceholder.typicode.com/users/1')\n      .then(res => res.json())\n      .then(data => setUser(data));\n  }, []);\n\n  return <p>{user ? user.name : 'Loading...'}</p>;\n}\n\nexport default User;",
      "showPreview": true,
      "explanation": "UI updates when data arrives."
    },

    "task": {
      "type": "coding-task",
      "title": "Fetch Todo",
      "description": "Show a todo title.",
      "requirements": [
        "useEffect",
        "fetch API",
        "Display title"
      ],
      "starterCode": "function Todo() {\n  return <p>Todo</p>;\n}\n\nexport default Todo;",
      "solution": "import { useEffect, useState } from 'react';\n\nfunction Todo() {\n  const [todo, setTodo] = useState(null);\n\n  useEffect(() => {\n    fetch('https://jsonplaceholder.typicode.com/todos/1')\n      .then(res => res.json())\n      .then(data => setTodo(data));\n  }, []);\n\n  return <p>{todo ? todo.title : 'Loading...'}</p>;\n}\n\nexport default Todo;",
      "hints": [
        "useEffect runs once",
        "Use empty dependency array"
      ]
    },

    "challenge": {
      "type": "coding-challenge",
      "title": "User List",
      "description": "Show first 5 users.",
      "requirements": [
        "Fetch users",
        "Use map",
        "Add key"
      ],
      "solution": "import { useEffect, useState } from 'react';\n\nfunction Users() {\n  const [users, setUsers] = useState([]);\n\n  useEffect(() => {\n    fetch('https://jsonplaceholder.typicode.com/users?_limit=5')\n      .then(res => res.json())\n      .then(data => setUsers(data));\n  }, []);\n\n  return (\n    <ul>\n      {users.map(user => (\n        <li key={user.id}>{user.name}</li>\n      ))}\n    </ul>\n  );\n}\n\nexport default Users;"
    },

    "memory": {
      "type": "memory-game",
      "title": "Data Fetch Memory",
      "pairs": [
        { "concept": "fetch", "code": "get data" },
        { "concept": "useEffect", "code": "after render" },
        { "concept": "state", "code": "store data" },
        { "concept": "dependency array", "code": "control runs" }
      ]
    },

    "tower": {
      "type": "tower-defense",
      "concepts": [
        {
          "question": "Where should API calls go?",
          "options": [
            "JSX",
            "useEffect",
            "render",
            "props"
          ],
          "correct": 1
        },
        {
          "question": "Empty dependency array means?",
          "options": [
            "Run always",
            "Run once",
            "Never run",
            "Run before render"
          ],
          "correct": 1
        }
      ],
      "waves": 3
    }
  }
}
