{
  "id": "react-021-refs",
  "title": "Refs in React",
  "description": "Access DOM elements and persist values without re-rendering",
  "duration": 9,
  "difficulty": "intermediate",
  "tags": ["react", "refs", "useRef", "dom"],
  "prerequisites": ["react-020-react-memo"],
  "unlocks": ["react-022-forward-ref"],
  "xp": 105,

  "steps": {
    "intro": {
      "type": "game-intro",
      "title": "Touch the DOM Safely",
      "story": "Sometimes React state is not the right tool. You need direct access.",
      "preview": "Learn how to use refs without breaking React rules."
    },

    "refresher": {
      "type": "markdown",
      "title": "Real-Life Example",
      "content": "# Remote Control\n\nYou press a button\n\nTV reacts immediately\n\nNo memory change\n\n---\n\nRefs work instantly\nwithout triggering re-render."
    },

    "concept": {
      "type": "markdown",
      "title": "What is a Ref?",
      "content": "A ref is a **reference to something**.\n\nIn React, refs are used to:\n- Access DOM elements\n- Store values without re-render\n- Focus inputs or trigger actions"
    },

    "concept2": {
      "type": "markdown",
      "title": "useRef Hook",
      "content": "useRef returns an object:\n\n- `.current` holds the value\n- Value persists between renders\n- Updating it does NOT re-render UI"
    },

    "syntax": {
      "type": "markdown",
      "title": "useRef Syntax",
      "content": "```\nconst myRef = useRef(null);\n\n<div ref={myRef} />\n```"
    },

    "positive": {
      "type": "interactive-code",
      "title": "Focus Input Using Ref",
      "description": "Focus input on button click.",
      "code": "import { useRef } from 'react';\n\nfunction FocusInput() {\n  const inputRef = useRef(null);\n\n  function focusNow() {\n    inputRef.current.focus();\n  }\n\n  return (\n    <div>\n      <input ref={inputRef} />\n      <button onClick={focusNow}>Focus</button>\n    </div>\n  );\n}\n\nexport default FocusInput;",
      "showPreview": true,
      "explanation": "Ref gives direct access to DOM element."
    },

    "concept3": {
      "type": "markdown",
      "title": "Ref vs State",
      "content": "State:\n- Causes re-render\n- Used for UI data\n\nRef:\n- No re-render\n- Used for DOM or internal values"
    },

    "positive2": {
      "type": "interactive-code",
      "title": "Persist Value Without Re-render",
      "description": "Track renders using ref.",
      "code": "import { useRef, useState } from 'react';\n\nfunction RenderCounter() {\n  const renders = useRef(0);\n  const [count, setCount] = useState(0);\n\n  renders.current += 1;\n\n  return (\n    <div>\n      <p>Count: {count}</p>\n      <p>Renders: {renders.current}</p>\n      <button onClick={() => setCount(count + 1)}>+</button>\n    </div>\n  );\n}\n\nexport default RenderCounter;",
      "showPreview": true,
      "explanation": "Ref value updates without triggering render."
    },

    "negative": {
      "type": "debug-quiz",
      "title": "Why UI Not Updating?",
      "description": "Using ref instead of state.",
      "code": "const value = useRef(0);\n\nfunction add() {\n  value.current += 1;\n}",
      "question": "Why UI doesn't update?",
      "options": [
        {
          "id": "a",
          "text": "Refs do not cause re-render",
          "isCorrect": true,
          "explanation": "Refs update silently."
        },
        {
          "id": "b",
          "text": "useRef is broken",
          "isCorrect": false,
          "explanation": "useRef works as designed."
        }
      ],
      "lesson": "Use state for UI updates."
    },

    "task": {
      "type": "coding-task",
      "title": "Auto Focus Input",
      "description": "Focus input when component mounts.",
      "requirements": [
        "useRef",
        "focus input"
      ],
      "starterCode": "function AutoFocus() {\n  return <input />;\n}\n\nexport default AutoFocus;",
      "solution": "import { useRef, useEffect } from 'react';\n\nfunction AutoFocus() {\n  const inputRef = useRef(null);\n\n  useEffect(() => {\n    inputRef.current.focus();\n  }, []);\n\n  return <input ref={inputRef} />;\n}\n\nexport default AutoFocus;"
    },

    "challenge": {
      "type": "coding-challenge",
      "title": "Stopwatch (Ref Based)",
      "description": "Store interval ID using ref.",
      "requirements": [
        "useRef",
        "start and stop timer"
      ],
      "solution": "import { useRef, useState } from 'react';\n\nfunction Stopwatch() {\n  const timerRef = useRef(null);\n  const [time, setTime] = useState(0);\n\n  function start() {\n    if (!timerRef.current) {\n      timerRef.current = setInterval(() => {\n        setTime(t => t + 1);\n      }, 1000);\n    }\n  }\n\n  function stop() {\n    clearInterval(timerRef.current);\n    timerRef.current = null;\n  }\n\n  return (\n    <div>\n      <p>{time}</p>\n      <button onClick={start}>Start</button>\n      <button onClick={stop}>Stop</button>\n    </div>\n  );\n}\n\nexport default Stopwatch;"
    },

    "memory": {
      "type": "memory-game",
      "title": "Refs Memory",
      "pairs": [
        { "concept": "useRef", "code": "mutable value" },
        { "concept": "current", "code": "stored data" },
        { "concept": "DOM access", "code": "direct control" },
        { "concept": "no re-render", "code": "silent update" }
      ]
    },

    "tower": {
      "type": "tower-defense",
      "concepts": [
        {
          "question": "useRef causes re-render?",
          "options": ["yes", "no", "sometimes", "only first render"],
          "correct": 1
        },
        {
          "question": "Best use of ref?",
          "options": ["UI data", "API data", "DOM access", "routing"],
          "correct": 2
        }
      ],
      "waves": 3
    }
  }
}
